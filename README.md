# Tea Advisor

> [English version](README.en.md)

Платформа для подбора чая с AI и семантическим поиском. Собирает данные о чае с [beliyles.com](https://beliyles.com), создаёт векторные эмбеддинги и даёт персонализированные рекомендации через веб-интерфейс.

## Возможности

- **Семантический поиск** - Поиск чая по описанию, вкусу, настроению или ингредиентам через векторное сходство
- **Двухэтапный AI-пайплайн** - Анализ запроса + интеллектуальный отбор из кандидатов
- **Умные фильтры** - Исключение пробников, наборов, товаров не в наличии; фильтр по серии
- **Аутентификация** - JWT + хеширование паролей Argon2
- **Современный стек** - Leptos 0.8 (Rust WASM), Axum, Turso (встроенная БД на Rust с векторным поиском)

## Архитектура

```
┌─────────────────────────────────────────────────────────┐
│  Запрос пользователя                                    │
└─────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────┐
│  Этап 1: Анализ запроса (LLM)                          │
│  → Извлекает: поисковые термины, количество, фильтры   │
└─────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────┐
│  Этап 2: Векторный поиск (Turso)                       │
│  → Возвращает N+4 кандидата по косинусному сходству    │
└─────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────┐
│  Этап 3: Отбор и описание (LLM)                        │
│  → Выбирает лучшие N чаёв, генерирует описания         │
└─────────────────────────────────────────────────────────┘
```

## Быстрый старт

### Требования

- Rust 2024 edition
- [cargo-leptos](https://github.com/leptos-rs/cargo-leptos)
- OpenRouter API ключ

### Установка

1. Клонируйте и настройте:
```bash
git clone https://github.com/okhsunrog/chai-rs
cd chai-rs
cp .env.example .env
# Отредактируйте .env: укажите OPENROUTER_API_KEY и JWT_SECRET
```

2. Заполните базу данных:
```bash
# Кэширование страниц с сайта
cargo run --package chai-cli -- cache

# Создание эмбеддингов и синхронизация в базу
cargo run --package chai-cli -- sync --from-cache
```

3. Запустите веб-приложение:
```bash
cd chai-web
cargo leptos watch
```

Откройте http://localhost:3000

## Команды CLI

```bash
# Кэширование HTML-страниц с сайта
cargo run --package chai-cli -- cache

# Синхронизация чаёв в базу с эмбеддингами
cargo run --package chai-cli -- sync --from-cache [--force]

# Поиск чаёв
cargo run --package chai-cli -- search "пряный согревающий чай" --limit 5

# Статистика базы данных
cargo run --package chai-cli -- stats
```

## Конфигурация

| Переменная | Описание | По умолчанию |
|------------|----------|--------------|
| `OPENROUTER_API_KEY` | Ключ OpenRouter API | (обязательно) |
| `JWT_SECRET` | Секрет для подписи JWT | (обязательно) |
| `DATABASE_PATH` | Путь к базе Turso | `data/chai.db` |
| `EMBEDDINGS_MODEL` | Модель эмбеддингов | `qwen/qwen3-embedding-8b` |
| `VECTOR_SIZE` | Размерность эмбеддингов | `4096` |

## Структура проекта

```
chai-rs/
├── chai-core/          # Общая библиотека (AI, auth, БД, скрапер)
├── chai-cli/           # CLI для управления данными
├── chai-web/           # Веб-интерфейс (Leptos + Axum)
├── deploy/             # Скрипты деплоя и systemd-сервисы
└── data/
    └── chai.db         # База Turso (пользователи, кэш, чаи + эмбеддинги)
```

## Технологии

- **Фронтенд**: Leptos 0.8 (Rust → WASM), SSR + Hydration
- **Бэкенд**: Axum, Tower (rate limiting)
- **База данных**: [Turso](https://github.com/tursodatabase/turso) (встраиваемая БД на Rust с нативным векторным поиском)
- **AI**: OpenRouter (эмбеддинги + LLM)
- **Авторизация**: JWT + Argon2

## Лицензия

MIT
